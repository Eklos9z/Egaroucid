# Egaroucid 使い方

オセロAI Egaroucidの公式ドキュメントです。このページの内容は最新バージョンに合わせてありますが、更新が追いつかない場合もあります。

このページは日本語のみです。

INSERT_TABLE_OF_CONTENTS_HERE

## 画面の見方

画面の見方を5つの項目に分けて解説します。

<div class="centering_box">
    <img class="pic2" src="img/screen.png">
</div>

### 盤面

オセロの盤面です。合法手(打てるところ)の表示や評価値などの表示もできます。マスを直接クリックすることで着手できます。

<ul>
    <li>評価値を表示できます</li>
    <li>うみがめ数を表示できます</li>
    <li>棋譜、盤面などによる入出力ができます</li>
    <li>盤面だけを切り取ったスクリーンショットを撮る機能があります</li>
</ul>

### 対局情報

盤面やAIに関係する情報をまとめて表示しています。

現在が何手目で、誰の手番なのか、現在の石数はいくつ対いくつなのか、定石名は何か、AIのレベルはいくつか、を表示しています。

### グラフ

対局の形勢を表すグラフを表示します。

横軸が手数(0手目から60手目まで)で、縦軸が形勢(石差)です。

グラフは真ん中の0で互角、上に行くと黒有利、下に行くと白有利です。

縦軸の値は最終石差の予測値を表していて、具体的には「この局面から双方最善手を打ち続けるとどちらが何石多く勝つか」という値です。

<ul>
    <li>対局中など、グラフを見たくないときには非表示にできます</li>
    <li><a href="#対局_分析">対局の解析を行うと全ての局面の値をまとめて計算できます</a></li>
    <li><a href="#表示_合法手への表示 > 石差評価">ヒントを表示した上で盤面を進めていくと自動で更新されます</a></li>
</ul>



### メニュー

各種操作を行います。

様々な機能がついているので、このサイトではメニューの構成に沿って機能を紹介します。

### ログ

AIの計算過程などを表示します。ユーザはあまり気にしなくて良いですが、なにか不具合があった場合の解決策のヒントになる場合があります。

<ul>
    <li><a href="#表示_ログ">ログ表示をオフにできます</a></li>
</ul>



## 対局

メニューのここから辿れる機能です。

<div class="centering_box">
    <img class="pic2" src="img/menu_game.png">
</div>

### 新規対局 (人間同士)

盤面を初期状態に戻します。AIが着手しない設定なので、そのまま人間が打ち進めます。石を並べる際や人間同士の対局で使うことを想定しています。

<ul>
    <li><a href="#設定_AIの着手設定">途中からAIに打たせることもできます</a></li>
</ul>


### 新規対局 (人間黒番)

盤面を初期状態に戻し、人間が黒番、AIが白番で対戦します。対局用途にも使えますが、ただ石を並べる用途を考えています。

<ul>
    <li><a href="#設定_AIの着手設定">途中からAIが着手する手番を変更できます</a></li>
    <li><a href="#設定_AIの着手設定">途中から人間同士/AI同士に設定できます</a></li>
</ul>


### 新規対局 (人間白番)

盤面を初期状態に戻し、AIが黒番、人間が白番で対戦します。

AIが初手なので、画面右上に対局開始ボタンが出現します。それを押すと対局が始まります。

<div class="centering_box">
    <img class="pic2" src="img/game_start_game_button.png">
</div>
<ul>
    <li><a href="#設定_AIの着手設定">途中からAIが着手する手番を変更できます</a></li>
    <li><a href="#設定_AIの着手設定">途中から人間同士/AI同士に設定できます</a></li>
</ul>


### 新規自己対戦

盤面を初期状態に戻し、AI同士で対戦します。

画面右上に対局開始ボタンが出現します。それを押すと対局が始まります。

<div class="centering_box">
    <img class="pic2" src="img/game_start_game_button.png">
</div>
<ul>
    <li><a href="#設定_AIの着手設定">途中からAIが着手する手番を変更できます</a></li>
    <li><a href="#設定_AIの着手設定">途中から人間同士/AI同士に設定できます</a></li>
</ul>


### 分析

対局を分析します。

1手ずつ評価値を再計算して、グラフに描画します。どこで悪手を打ったのかがわかりやすいです。



## 設定

メニューのここから辿れる機能です。

<div class="centering_box">
    <img class="pic2" src="img/settings.png">
</div>



### book使用

AIの着手やヒント計算にbookを使うか否かを選択できます。

bookとは、予め局面に対して評価値を計算しておいたものです。

<ul>
    <li>bookを自動で拡張できます</li>
    <li>bookを手動で修正できます</li>
    <li>bookのファイル指定ができます</li>
    <li>bookの統合ができます</li>
</ul>

### book変化レベル

bookには最善手以外の手も収録されています。AIの着手時にそのような悪手をどれくらいの確率で打つかを決められます。

book変化レベルが0だと最善手しか打ちません。値が大きくなると悪手を積極的に打つようになります。

最大でbook変化レベルの2倍の石損を許すという意図の設定です。ただ、石損が大きい手は選ぶ確率が低いです。

具体的な計算手法は以下です。

book変化レベルが$X$で、ある局面から手を選択するとき、bookに登録されている着手の評価値の集合を$A=\{(v,m)\}$とします。ここで、$v$は(手番目線の)評価値、$m$は手です。

$B=\left\{(v,m)\in A\middle|v\geq v_{\mathrm{max}}-2X\right\}$

で定義される$B$を作り、$2X$石損以下の手を厳選します。なお、$v_{\mathrm{max}}$は最善手の評価値です。そして

$C=\left\{(s,m)\middle| s=\left(\exp\left(\frac{v-v_{\mathrm{max}}+1.5}{3}\right)\right)^{(10-X)}\right\}$

$D=\left\{(s,m)\middle| s=\frac{s}{c_{\mathrm{sum}}}\right\}$

softmax的に変換します。$c_{\mathrm{sum}}$は$C$の$s$の合計値です。

そしてここで$r$を0以上1未満のランダムな値として、

$r\leq\sum_{j=0}^{i}{s'_j}$

かつ

$r>\sum_{j=0}^{i-1}{s'_j}$

を満たす$i$を見つけ、$M_i$を着手する手として採用します。

### レベル

AIのレベルを設定できます。

AIのレベルは、

<ul>
    <li>中盤の読みの深さ</li>
    <li>終盤の読み切りタイミング</li>
    <li>探索の精度の確率</li>
</ul>

という3つの観点で定義されます。レベルを上げると、中盤は深くまで読み、終盤の読み切りタイミングは早く、探索の精度の確率は上がります。

ここで設定するレベルは、<a href="#設定_AIの着手設定">AIの着手</a>、ヒント表示、<a href="#対局_分析">対局分析</a>、Book学習の全てで統一して使われます。

「探索の精度の確率」と書いたのは、Multi-ProbCutという技術で用いられる確率のことです。Multi-ProbCutは、明らかな悪手の探索を省略するものです。確率が低ければ大胆に、確率が高ければ少しだけ省略します。なお、100%の場合は探索を省略しません。

各レベルのパラメータは<a href="#画面の見方_グラフ">グラフエリア</a>に表示されています。下図はレベル27のグラフです。これを見ると、

<ul>
    <li>23手目までは中盤探索を行い、27手読みを75%の精度で行う</li>
    <li>24手目からは終局まで読み切る</li>
    <li>読み切りは88%の精度から始まって、終局に近づき32手目で100%の完全読みを行う</li>
</ul>

ということがわかります。グラフに重ねて描画されるので、グラフの点がどのような探索の結果なのかがわかりやすいです。

<div class="centering_box">
    <img class="pic2" src="img/graph_area.png">
</div>

### スレッド数

ここでは、並列計算についての設定をします。

お使いのCPUが$X$コア$Y$スレッドであれば、$Y$に近い値に設定すると高速になると思います。

デフォルトで$Y$に自動的に設定されるようになっています。

### ハッシュレベル

Egaroucidでは探索時に、一部の探索結果を保存しておきます。その保存領域の大きさを決められます。大きくするとメモリ消費量が増え、探索が高速になる可能性が高まります。

ハッシュレベルを$X$とすると、この保存領域において以下の表で示されるメモリを消費します。

<table>
<tr>
<th>ハッシュレベル$X$</th>
<th>メモリ消費量(GB)</th>
</tr>
<tr>
<td>23</td>
<td>0.75</td>
</tr>
<tr>
<td>24</td>
<td>0.75</td>
</tr>
<tr>
<td>25</td>
<td>0.75</td>
</tr>
<td>26</td>
<td>1.5</td>
</tr>
<td>27</td>
<td>3.0</td>
</tr>
</table>

内部的には、$2^X$個の局面を保存できるようにする大きさのハッシュテーブルを作っています。

### AIの着手設定

「AIが黒に着手」「AIが白に着手」によって、対局中でもAIの着手設定を変更できます。

両方のチェックを外せば途中から人間同士の対局(ただ石を並べるだけ)になります。

<ul>
    <li><a href="#対局">対局開始時に1クリックで設定できます</a></li>
</ul>

### パスで一時停止

人間とAIの対局で、人間のパスの時に人間が明示的にパスであるというボタンを押すかどうかの設定です。下図はこのモードをオンにしたときで、黒番が人間ですが置く場所がないのでパスボタンが出現しています。

<div class="centering_box">
    <img class="pic2" src="img/pass_button.png">
</div>

## 表示

メニューのここから辿れる機能です。

<div class="centering_box">
    <img class="pic2" src="img/display.png">
</div>
### 合法手への表示 > 合法手

盤面に合法手を表示するかどうか設定できます。合法手は水色の小さな点で表されます。

<div class="centering_box">
    <img class="pic2" src="img/legal_moves.png">
</div>

### 合法手への表示 > 石差評価

合法手のマスに評価値(最終石差)を表示するかどうか選択できます。ヒント表示と表記する場合もあります。

また、全ての合法手に対して評価値を計算すると計算が遅い場合、表示個数を選択できます。下の画像では4つを選択しており、これは上位4手の評価値を表示するという意味です。

<div class="centering_box">
    <img class="pic2" src="img/hint.png">
</div>

### 合法手への表示 > うみがめ数

bookに登録されている局面について、うみがめ数を計算して表示します。

マスの右下に、黒と白のうみがめ数が表示されます。

<div class="centering_box">
    <img class="pic2" src="img/umigame.png">
</div>

### 合法手への表示 > 定石

マスにマウスをホバーしたときに定石名を出してくれます。

<a href="#画面の見方_対局情報">対局情報</a>に定石名は書かれていますが、ここで表示されるのは、「この手に打ったらどんな定石になるか」です。

<div class="centering_box">
    <img class="pic2" src="img/opening_on_cell.png">
</div>

### 合法手への表示 > 直後の手

対局を振り返るなどして盤面を戻したとき、直後に打った手を薄く表示します。

<div class="centering_box">
    <img class="pic2" src="img/next_move.png">
</div>

### 石への表示 > 直前の手

直前に打った手を小さい赤丸で表示できます。

<div class="centering_box">
    <img class="pic2" src="img/last_move.png">
</div>

### 石への表示 > 確定石

盤面に存在する確定石を黄丸で表示します。なお、これは全ての確定石を計算できるものではありません。

<div class="centering_box">
    <img class="pic2" src="img/stable_discs.png">
</div>

この機能の実装には、AI内部で探索のために確定石を計算するところを流用しています。

### グラフ

グラフの表示/非表示を選択できます。非表示にすると画像のように、薄灰色の点だけでグラフが描画されます。この点は0のところだけにあり、特に上下しません。

内部的にグラフの情報はずっと保持しているので、表示に切り替えるとすぐに値が反映されます。

グラフは、AIの着手時、<a href="#表示_合法手への表示 > 石差評価">ヒント表示をしているとき</a>、<a href="#対局_分析">対局の分析をしたとき</a>に自動で更新されます。

<div class="centering_box">
    <img class="pic2" src="img/graph_show.png">
</div>

### ログ

ログの表示/非表示を切り替えられます。

AIの計算中、ログには評価値が現れるので、本気で対戦したいときにはグラフと一緒にログも非表示にすることをおすすめします。



## 操作

### 進む/戻る

局面を戻したり進めたりできます。これ以上戻れない/進めない場合、何も起こりません。

なお、ショートカットキーとして、単に右矢印キーを押すかDキーを押すだけでも局面を進められます。また、左矢印キーかAキーを押すと局面を戻せます。

### 待った

局面を戻すと同時に、直後の手を打たなかったことにできます。対局中に「待った」をしたいときや、石を並べているときに打つ手を変更したいときに使えます。

なお、ショートカットキーとしてバックスペースキーを割り当てています。

### この分岐を保存



### 変換

### 計算停止 (AI操作)

### キャッシュクリア (AI操作)



## 入出力

### 入力 > 棋譜入力

### 入力 > 盤面入力

### 入力 > 盤面編集

### 入力 > 対局読み込み

### 出力 > 現局面までの棋譜をコピー

### 出力 > 対局保存

### 出力 > スクリーンショット

### 出力 > ボードの画像を編集



## Book

### 学習の設定 > 深さ

### 学習の設定 > 1手あたりの誤差

### 学習の設定 > 手筋の合計誤差

### Book操作 > 右クリックで編集

### Book操作 > Book拡張

### Book操作 > Book修正

### Book操作 > 深さ上限設定

### Book操作 > レベル上書き

### ファイル操作 > 統合

### ファイル操作 > bookの参照

### ファイル操作 > Edax形式で保存



## ヘルプ

### 使い方

このページへ飛べるボタンです。

### Webサイト

Egaroucid公式サイトのトップページに飛べるボタンです。

### バグレポート

バグ報告や機能追加依頼などができるGoogleフォームに飛べるボタンです。

### 自動更新確認

Egaroucidの起動時に更新を自動で確認するかを選択できます。

Egaroucidは過去バージョンとの互換性を極力高めて開発しており、最新バージョンでは様々なバグを解消していますので、常に最新バージョンへのアップデートを推奨します。

### Egaroucid/Siv3Dのライセンス

Egaroucidのライセンス、およびEgaroucidで使用しているライブラリであるSiv3Dのライセンスを表示できます。

